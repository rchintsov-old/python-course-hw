#!/usr/bin/env python3.6

import argparse
import sys

from supertool import weather as w


if __name__ == '__main__':

    parser = argparse.ArgumentParser(description='Weather forecast for specified city.')

    parser.add_argument('city', type=str, metavar='CITY',
                        help='City where need to show the weather.')
    parser.add_argument('--token', metavar='TOKEN', type=str, help='API token', default='')
    parser.add_argument('--street', metavar='STREET', type=str, help='Street', default='')
    parser.add_argument('--house', metavar='HOUSENUM', type=str, help='House number', default='')

    args = parser.parse_args()

    # switch script to test mode if token wasn't specified
    if args.token:
        test = False
    else:
        test = True

    # getting info and preparing it to show in console
    # coordinates
    try:
        coord_dict = w.get_coordinates(args.city, args.street, args.house)
    except AddressException as coord_e:
        print(coord_e.args[0])
        sys.exit(2)
    except ConnecionFail as conn_e:
        print(conn_e.args[0])
        sys.exit(1)

    # weather
    try:
        json_answer = w.get_weather(coord_dict, token=args.token, test=test)
    except ConnecionFail as conn_e:
        print(conn_e.args[0])
        sys.exit(1)

    # preparing
    five_days, current_day, city = w.prepare_forecast(json_answer)

    # show in console
    w.print_weather(five_days, current_day, city)

